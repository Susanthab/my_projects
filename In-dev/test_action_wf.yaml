version: '2.0'

nibiru.test_action:
  description: Test action.
  type: direct
  input:
    - Role_name 
    - Region
    - Assume_role
    - consul_endpoint

  vars:
    Asg_name: "mongo-asg-2"

  tasks:

    assume_role:
      action: boto3.assume_role
      input:
        role_arn: <% $.Assume_role %>
      publish:
        credentials: <% task(assume_role).result.result %>
      on-success:
        - get_vpc_configuration

    get_vpc_configuration:
      action: nibiru.get_consul_json
      publish:
        vpc_config: <% task(get_vpc_configuration).result.result %>
      input:
        consul_endpoint: <% $.consul_endpoint %>
      on-success:
        - t1

    t1:
      action: core.local
      input:
        cmd: "echo '<% $.vpc_config.security_groups['0'] %>'"