resource "aws_ssm_document" "db-cb-restore" {
  name          = "${local.fullname}-couchbase-cbrestore"

  document_type = "Command"

  content = <<DOC
  {
      "schemaVersion": "2.2",
      "description": "Run cbrestore",
      "parameters": {
            "Host": {
              "type": "String",
              "description": "CB node ip which needs to restore the backup"
          },
          "SourceBucketName": {
              "type": "String",
              "description": "Source bucket name"
          },     
          "DestinationBucketName": {
              "type": "String",
              "description": "Destination bucket name"
          },
            "BackupFilePath": {
              "type": "String",
              "description": "full path (s3) of the backup file"
          },
            "BucketRamsize": {
              "type": "String",
              "description": "Bucket RAM size"
          }        
      },
      "mainSteps": [
        {
          "action": "aws:runShellScript",
          "name": "hostlist",
          "inputs": {
            "runCommand": ["/usr/local/bin/bitesize_cbrestore.sh {{Host}} {{SourceBucketName}} {{DestinationBucketName}} {{BackupFilePath}} {{BucketRamsize}}"]
          }
        }
      ]
    }
    DOC
}